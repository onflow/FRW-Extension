# Test info

- Name: Verify sufficient token balances for sender account
- Location: /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/balance-transaction.test.ts:141:1

# Error details

```
Error: One or more token balances are insufficient for senderci (0xbd2f55be82df6d30). See attached report.

expect(received).toBeTruthy()

Received: false
    at /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/balance-transaction.test.ts:176:5
```

# Page snapshot

```yaml
- banner:
  - button "üçã":
    - paragraph: üçã
  - paragraph: ü¶Å
  - button "Lemon EVM 0x000000...21d883F5":
    - text: Lemon EVM 0x000000...21d883F5
    - img
  - button "notification": "7"
  - button "avatar"
- paragraph: development build
- paragraph: $0.60USD
- button:
  - img
- paragraph: Send
- button:
  - img
- paragraph: Receive
- button:
  - img
- paragraph: Swap
- button:
  - img
- paragraph: Buy
- button:
  - img
- paragraph: Move
- tablist "full width tabs example":
  - tab "coins" [selected]:
    - img
    - paragraph: coins
  - tab "NFTs":
    - img
    - paragraph: NFTs
  - tab "Activity":
    - img
    - paragraph: Activity
- tabpanel:
  - button "Manage":
    - img "Manage"
  - button "Add":
    - img "Add"
  - list:
    - listitem:
      - button "FLOW $0.30USD":
        - img
        - paragraph: FLOW
        - img
        - paragraph: $0.30USD
      - paragraph: 0.12 FLOW
      - paragraph: $0.037USD
    - listitem:
      - button "Increment Staked FLOW $0.43USD":
        - img
        - paragraph: Increment Staked FLOW
        - img
        - paragraph: $0.43USD
      - paragraph: 0.55 STFLOW
      - paragraph: $0.24USD
    - listitem:
      - button "Bridged USDC (Celer) $1USD":
        - img
        - paragraph: Bridged USDC (Celer)
        - img
        - paragraph: $1USD
      - paragraph: 0.23 USDC.E
      - paragraph: $0.23USD
    - listitem:
      - button "OFFICIAL TRUMP $8.74USD":
        - img
        - paragraph: OFFICIAL TRUMP
        - img
        - paragraph: $8.74USD
      - paragraph: 0.0098 TRUMP
      - paragraph: $0.085USD
    - listitem:
      - button "BETA $0.0496USD":
        - img
        - paragraph: BETA
        - img
        - paragraph:
          - text: $0.0
          - subscript: "4"
          - text: 96USD
      - paragraph: 122.15 BETA
      - paragraph: $0.012USD
```

# Test source

```ts
   76 |     context,
   77 |   };
   78 | };
   79 |
   80 | // Helper to run checks for a specific context (Cadence or EVM)
   81 | const runBalanceChecks = async (
   82 |   page,
   83 |   requiredBalances: Record<string, string>,
   84 |   context: 'Cadence' | 'EVM'
   85 | ): Promise<BalanceCheckResult[]> => {
   86 |   const results: BalanceCheckResult[] = [];
   87 |   for (const [tokenName, requiredBalance] of Object.entries(requiredBalances)) {
   88 |     const balance = await getTokenBalance(page, tokenName);
   89 |     const result = checkTokenBalance(tokenName, balance, requiredBalance, context);
   90 |     results.push(result);
   91 |   }
   92 |   return results;
   93 | };
   94 |
   95 | // Helper to format and log results, and return overall sufficiency
   96 | const reportAndCheckOverallSufficiency = (
   97 |   testInfo: ReturnType<typeof test.info>,
   98 |   results: BalanceCheckResult[],
   99 |   nickname: string,
  100 |   address: string
  101 | ): boolean => {
  102 |   const tableData = [
  103 |     ['Context', 'Token', 'Required', 'Actual', 'Sufficient'],
  104 |     ...results.map((r) => [
  105 |       r.context,
  106 |       r.tokenName,
  107 |       r.required,
  108 |       r.actual,
  109 |       r.sufficient ? '‚úÖ' : '‚ùå',
  110 |     ]),
  111 |   ];
  112 |
  113 |   // Format the table as a string for attachment
  114 |   const reportTitle = `Balance Check Report for ${nickname} (${address})`;
  115 |   const reportContent = table(tableData);
  116 |   const fullReport = `${reportTitle}\n\n${reportContent}`;
  117 |
  118 |   // Attach the report to the Playwright test results
  119 |   testInfo.attach('balance-report', {
  120 |     body: fullReport,
  121 |     contentType: 'text/plain',
  122 |   });
  123 |
  124 |   // Still log summary status to console for quick CI feedback
  125 |   console.log(`\n--- ${reportTitle} ---`);
  126 |   console.log(reportContent); // Keep console log for immediate feedback if needed
  127 |
  128 |   const allSufficient = results.every((r) => r.sufficient);
  129 |   if (!allSufficient) {
  130 |     console.error(
  131 |       `--> Insufficient balances found for ${nickname} (${address}). Check attached report.`
  132 |     );
  133 |   } else {
  134 |     console.log(`--> All balances sufficient for ${nickname} (${address}).`);
  135 |   }
  136 |   console.log(`--------------------------------------------------------\n`);
  137 |
  138 |   return allSufficient;
  139 | };
  140 |
  141 | test('Verify sufficient token balances for sender account', async ({ page, extensionId }) => {
  142 |   test.slow();
  143 |   const nickname = process.env.TEST_SENDER_NICKNAME || 'Sender';
  144 |   const address = process.env.TEST_SENDER_ADDR || 'Unknown Address';
  145 |   const evmAddress = process.env.TEST_SENDER_EVM_ADDR || 'Unknown EVM Address';
  146 |   console.log(`Starting balance check for Sender: ${nickname} (${address})`);
  147 |
  148 |   // Login to sender account
  149 |   await loginToSenderAccount({ page, extensionId });
  150 |
  151 |   let allResults: BalanceCheckResult[] = [];
  152 |
  153 |   // Check Cadence wallet balances
  154 |   console.log('Checking Cadence balances...');
  155 |   const cadenceResults = await runBalanceChecks(page, REQUIRED_BALANCES_CADENCE, 'Cadence');
  156 |   allResults = allResults.concat(cadenceResults);
  157 |
  158 |   // Switch to EVM wallet and check balances
  159 |   console.log('Switching to EVM and checking balances...');
  160 |   await switchToEvmAddress({ page, address: evmAddress });
  161 |   const evmResults = await runBalanceChecks(page, REQUIRED_BALANCES_EVM, 'EVM');
  162 |   allResults = allResults.concat(evmResults);
  163 |
  164 |   // Report results and check overall sufficiency
  165 |   const overallSufficient = reportAndCheckOverallSufficiency(
  166 |     test.info(),
  167 |     allResults,
  168 |     nickname,
  169 |     address
  170 |   );
  171 |
  172 |   // Assert based on the overall result
  173 |   expect(
  174 |     overallSufficient,
  175 |     `One or more token balances are insufficient for ${nickname} (${address}). See attached report.`
> 176 |   ).toBeTruthy();
      |     ^ Error: One or more token balances are insufficient for senderci (0xbd2f55be82df6d30). See attached report.
  177 |
  178 |   console.log(`Sender (${nickname}) balance verification complete.`);
  179 | });
  180 |
  181 | test('Verify sufficient token balances for receiver account', async ({ page, extensionId }) => {
  182 |   const nickname = process.env.TEST_RECEIVER_NICKNAME || 'Receiver';
  183 |   const address = process.env.TEST_RECEIVER_ADDR || 'Unknown Address';
  184 |   const evmAddress = process.env.TEST_RECEIVER_EVM_ADDR || 'Unknown EVM Address';
  185 |   console.log(`Starting balance check for Receiver: ${nickname} (${address})`);
  186 |
  187 |   // Login to receiver account
  188 |   await loginToReceiverAccount({ page, extensionId });
  189 |
  190 |   let allResults: BalanceCheckResult[] = [];
  191 |
  192 |   // Check Cadence wallet balances
  193 |   console.log('Checking Cadence balances...');
  194 |   const cadenceResults = await runBalanceChecks(page, REQUIRED_BALANCES_CADENCE, 'Cadence');
  195 |   allResults = allResults.concat(cadenceResults);
  196 |
  197 |   // Switch to EVM wallet and check balances
  198 |   console.log('Switching to EVM and checking balances...');
  199 |   await switchToEvmAddress({ page, address: evmAddress });
  200 |   const evmResults = await runBalanceChecks(page, REQUIRED_BALANCES_EVM, 'EVM');
  201 |   allResults = allResults.concat(evmResults);
  202 |
  203 |   // Report results and check overall sufficiency
  204 |   const overallSufficient = reportAndCheckOverallSufficiency(
  205 |     test.info(),
  206 |     allResults,
  207 |     nickname,
  208 |     address
  209 |   );
  210 |
  211 |   // Assert based on the overall result
  212 |   expect(
  213 |     overallSufficient,
  214 |     `One or more token balances are insufficient for ${nickname} (${address}). See attached report.`
  215 |   ).toBeTruthy();
  216 |
  217 |   console.log(`Receiver (${nickname}) balance verification complete.`);
  218 | });
  219 |
```