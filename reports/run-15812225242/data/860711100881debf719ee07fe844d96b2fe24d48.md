# Test info

- Name: send Cadence transactions
- Location: /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/cadence-transaction.test.ts:79:1

# Error details

```
Error: page.waitForURL: Target page, context or browser has been closed
=========================== logs ===========================
waiting for navigation until "load"
============================================================
    at getCurrentAddress (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:24:14)
    at loginToExtensionAccount (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:66:24)
    at loginToSenderAccount (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:343:3)
    at loginToSenderOrReceiver (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:425:5)
    at /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/cadence-transaction.test.ts:73:3
```

# Test source

```ts
   1 | import { type Page } from '@playwright/test';
   2 |
   3 | import { isValidEthereumAddress } from '../../src/shared/utils/address';
   4 |
   5 | import { getAuth, saveAuth, expect } from './loader';
   6 | export const getClipboardText = async () => {
   7 |   const text = await navigator.clipboard.readText();
   8 |   return text;
   9 | };
   10 |
   11 | export const closeOpenedPages = async (page: Page) => {
   12 |   const allPages = page.context().pages();
   13 |   if (allPages.length > 1) {
   14 |     for (const p of allPages) {
   15 |       if (p !== page) {
   16 |         await p.close();
   17 |       }
   18 |     }
   19 |   }
   20 | };
   21 |
   22 | export const getCurrentAddress = async (page: Page) => {
   23 |   // Wait for the dashboard page to be fully loaded
>  24 |   await page.waitForURL(/.*\/dashboard.*/);
      |              ^ Error: page.waitForURL: Target page, context or browser has been closed
   25 |
   26 |   //await expect(page.getByLabel('Copy Address')).toBeVisible({ timeout: 120_000 });
   27 |   const copyIcon = page.getByTestId('copy-address-button');
   28 |   await expect(copyIcon).toBeEnabled({ timeout: 120_000 });
   29 |
   30 |   // const flowAddr = await page.getByTestId('account-address').textContent();
   31 |   await copyIcon.click();
   32 |
   33 |   const flowAddr = await page.evaluate(getClipboardText);
   34 |   return flowAddr;
   35 | };
   36 |
   37 | export const lockExtension = async ({ page }) => {
   38 |   // Assume we're logged in before calling this
   39 |
   40 |   await page.getByTestId('account-menu-button').click();
   41 |   await page.getByRole('button', { name: 'Lock Wallet' }).click();
   42 |   const unlockBtn = await page.getByRole('button', { name: 'Unlock Wallet' });
   43 |
   44 |   await expect(unlockBtn).toBeEnabled({ enabled: true, timeout: 60_000 });
   45 | };
   46 |
   47 | export const loginToExtensionAccount = async ({ page, extensionId, addr, password, nickname }) => {
   48 |   // close all pages except the current page
   49 |   await closeOpenedPages(page);
   50 |
   51 |   // Navigate and wait for network to be idle
   52 |   await page.goto(`chrome-extension://${extensionId}/index.html#/unlock`);
   53 |
   54 |   await page.waitForSelector('.logoContainer', { state: 'visible' });
   55 |   await closeOpenedPages(page);
   56 |
   57 |   await fillInPassword({ page, password });
   58 |
   59 |   const unlockBtn = await page.getByRole('button', { name: 'Unlock Wallet' });
   60 |
   61 |   await expect(unlockBtn).toBeEnabled({ enabled: true, timeout: 60_000 });
   62 |
   63 |   // close all pages except the current page (the extension opens them in the background)
   64 |   await unlockBtn.click();
   65 |   // get address
   66 |   let flowAddr = await getCurrentAddress(page);
   67 |   if (flowAddr !== addr && isValidEthereumAddress(flowAddr)) {
   68 |     await switchToMainAccount({ page, address: addr });
   69 |     flowAddr = await getCurrentAddress(page);
   70 |   }
   71 |   if (flowAddr !== addr) {
   72 |     // switch to the correct account
   73 |     await page.getByTestId('account-menu-button').click();
   74 |     await page.getByRole('button', { name: 'close' }).click();
   75 |     await expect(page.getByText('Profiles', { exact: true })).toBeVisible();
   76 |     // Switch to the correct account. Note doest not handle more than 3 accounts loaded
   77 |     await page.getByTestId(`profile-item-nickname-${nickname}`).click();
   78 |     await expect(page.getByRole('progressbar').getByRole('img')).not.toBeVisible();
   79 |     // get address
   80 |     flowAddr = await getCurrentAddress(page);
   81 |     if (flowAddr !== addr && isValidEthereumAddress(flowAddr)) {
   82 |       await switchToMainAccount({ page, address: addr });
   83 |       flowAddr = await getCurrentAddress(page);
   84 |     }
   85 |   }
   86 |
   87 |   expect(flowAddr).toBe(addr);
   88 |
   89 |   // Wait for the coins to be loaded
   90 |   await expect(page.getByTestId('coin-balance-flow')).toBeVisible({ timeout: 30_000 });
   91 | };
   92 |
   93 | export const loginAsTestUser = async ({ page, extensionId }) => {
   94 |   const keysFile = await getAuth();
   95 |
   96 |   if (keysFile.password === '') {
   97 |     return false;
   98 |   }
   99 |
  100 |   const { password, addr, nickname } = keysFile;
  101 |
  102 |   return loginToExtensionAccount({ page, extensionId, password, addr, nickname });
  103 | };
  104 |
  105 | const getNumber = (str: string) => {
  106 |   const match = str.match(/\d+/);
  107 |   return match ? parseInt(match[0]) : null;
  108 | };
  109 |
  110 | export const fillInPassword = async ({ page, password }) => {
  111 |   // Handle both create a password and confirm your password
  112 |   let filledAtLeastOneField = false;
  113 |   if (await page.getByLabel('Password').isVisible()) {
  114 |     await page.getByLabel('Password').clear();
  115 |     await page.getByLabel('Password').fill(password);
  116 |     filledAtLeastOneField = true;
  117 |   }
  118 |
  119 |   if (await page.getByPlaceholder('Enter your password').isVisible()) {
  120 |     await page.getByPlaceholder('Enter your password').clear();
  121 |     await page.getByPlaceholder('Enter your password').fill(password);
  122 |     filledAtLeastOneField = true;
  123 |   }
  124 |   if (await page.getByPlaceholder('Create a password').isVisible()) {
```