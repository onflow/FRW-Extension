# Test info

- Name: EVM transactions
- Location: /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/evm-transaction.test.ts:79:1

# Error details

```
Error: Timed out 60000ms waiting for expect(locator).toBeVisible()

Locator: getByTestId(/^.*1a93891d056a2f9609d1bbb9952c1fc2829986f138266a3310ba9282915c39f9.*$/).filter({ hasText: 'Pending' })
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 60000ms
  - waiting for getByTestId(/^.*1a93891d056a2f9609d1bbb9952c1fc2829986f138266a3310ba9282915c39f9.*$/).filter({ hasText: 'Pending' })

    at waitForTransaction (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:504:29)
    at sendTokenCOA (/home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/evm-transaction.test.ts:32:16)
    at /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/evm-transaction.test.ts:85:15
```

# Page snapshot

```yaml
- banner:
  - button "🍋":
    - paragraph: 🍋
  - paragraph: 🦁
  - button "Lemon EVM 0x000000...21d883F5":
    - text: Lemon EVM 0x000000...21d883F5
    - img
  - button "notification": "7"
  - button "avatar"
- paragraph: development build
- paragraph: $0.67USD
- button:
  - img
- paragraph: Send
- button:
  - img
- paragraph: Receive
- button:
  - img
- paragraph: Swap
- button:
  - img
- paragraph: Buy
- button:
  - img
- paragraph: Move
- tablist "full width tabs example":
  - tab "coins":
    - img
    - paragraph: coins
  - tab "NFTs":
    - img
    - paragraph: NFTs
  - tab "Activity" [selected]:
    - img
    - paragraph: Activity
- tabpanel:
  - listitem
  - listitem
```

# Test source

```ts
  404 |     // We've logged into the sender account, and we need to send tokens to the receiver account
  405 |     return process.env.TEST_SENDER_EVM_ADDR;
  406 |   } else {
  407 |     // We've logged into the receiver account, and we need to send tokens back to the sender account
  408 |     return process.env.TEST_RECEIVER_EVM_ADDR;
  409 |   }
  410 | };
  411 | export const getReceiverEvmAccount = ({ parallelIndex }) => {
  412 |   // If parallel index is 0, login to sender account, otherwise login to receiver account
  413 |   if (parallelIndex === 0) {
  414 |     // We've logged into the sender account, and we need to send tokens to the receiver account
  415 |     return process.env.TEST_RECEIVER_EVM_ADDR;
  416 |   } else {
  417 |     // We've logged into the receiver account, and we need to send tokens back to the sender account
  418 |     return process.env.TEST_SENDER_EVM_ADDR;
  419 |   }
  420 | };
  421 |
  422 | export const loginToSenderOrReceiver = async ({ page, extensionId, parallelIndex }) => {
  423 |   // If parallel index is 0, login to sender account, otherwise login to receiver account
  424 |   if (parallelIndex === 0) {
  425 |     await loginToSenderAccount({ page, extensionId });
  426 |   } else {
  427 |     await loginToReceiverAccount({ page, extensionId });
  428 |   }
  429 | };
  430 |
  431 | export const switchToEvmAddress = async ({ page, address }) => {
  432 |   // Assume the user is on the dashboard page
  433 |   await page.getByTestId('account-menu-button').click();
  434 |   // switch to COA account
  435 |   await page
  436 |     .getByTestId(new RegExp(`evm-account-${address}`, 'i'))
  437 |     .first()
  438 |     .click();
  439 |   // get address
  440 |   await getCurrentAddress(page);
  441 | };
  442 |
  443 | export const switchToMainAccount = async ({ page, address }) => {
  444 |   // Assume the user is on the dashboard page
  445 |   await page.getByTestId('account-menu-button').click();
  446 |   // switch to another flow account
  447 |   await page
  448 |     .getByTestId(new RegExp(`main-account-${address}`, 'i'))
  449 |     .first()
  450 |     .click();
  451 |   // get address
  452 |   await getCurrentAddress(page);
  453 | };
  454 | const getActivityItemRegexp = (txId: string, ingoreFlowCharge = false) => {
  455 |   return new RegExp(`^.*${txId}.*${ingoreFlowCharge ? '(?<!FlowToken)' : ''}$`);
  456 | };
  457 |
  458 | export const checkSentAmount = async ({
  459 |   page,
  460 |   sealedText,
  461 |   amount,
  462 |   txId,
  463 |   ingoreFlowCharge = false,
  464 | }) => {
  465 |   const activityItemRegexp = getActivityItemRegexp(txId, ingoreFlowCharge);
  466 |   const sealedItem = page.getByTestId(activityItemRegexp).filter({ hasText: sealedText });
  467 |   await expect(sealedItem).toBeVisible({
  468 |     timeout: 60_000,
  469 |   });
  470 |   await expect(
  471 |     page.getByTestId(activityItemRegexp).getByTestId(`token-balance-${amount}`)
  472 |   ).toBeVisible();
  473 | };
  474 |
  475 | export const waitForTransaction = async ({
  476 |   page,
  477 |   successtext = 'success',
  478 |   amount = '',
  479 |   ingoreFlowCharge = false,
  480 | }: {
  481 |   page: Page;
  482 |   successtext?: string | RegExp;
  483 |   amount?: string;
  484 |   ingoreFlowCharge?: boolean;
  485 | }) => {
  486 |   // Wait for the transaction to be completed
  487 |   await page.waitForURL(/.*dashboard\?activity=1.*/);
  488 |   const url = await page.url();
  489 |
  490 |   const txId = url.match(/[\?&]txId=(\w+)/i)?.[1];
  491 |
  492 |   expect(txId).toBeDefined();
  493 |
  494 |   if (!txId) {
  495 |     throw new Error('Transaction ID is not found');
  496 |   }
  497 |   const progressBar = page.getByRole('progressbar');
  498 |   await expect(progressBar).toBeVisible();
  499 |   // Get the pending item with the cadence txId that was put in the url and status is pending
  500 |
  501 |   const activityItemRegexp = getActivityItemRegexp(txId, ingoreFlowCharge);
  502 |   const pendingItem = page.getByTestId(activityItemRegexp).filter({ hasText: 'Pending' });
  503 |
> 504 |   await expect(pendingItem).toBeVisible({
      |                             ^ Error: Timed out 60000ms waiting for expect(locator).toBeVisible()
  505 |     timeout: 60_000,
  506 |   });
  507 |   /// await expect(progressBar).not.toBeVisible({ timeout: 60_000 });
  508 |
  509 |   // Get the executed item with the cadence txId that was put in the url and status is success
  510 |   const executedItem = page.getByTestId(activityItemRegexp).filter({ hasText: successtext });
  511 |
  512 |   await expect(executedItem).toBeVisible({
  513 |     timeout: 60_000,
  514 |   });
  515 |
  516 |   if (amount) {
  517 |     await expect(
  518 |       page.getByTestId(activityItemRegexp).getByTestId(`token-balance-${amount}`)
  519 |     ).toBeVisible();
  520 |   }
  521 |
  522 |   return txId;
  523 | };
  524 |
```