# Test info

- Name: Import sender and receiver accounts
- Location: /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/transaction.setup.ts:4:1

# Error details

```
Error: locator.click: Target page, context or browser has been closed
Call log:
  - waiting for getByTestId('import-existing-account-button')

    at importAccountBySeedPhrase (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:263:62)
    at importReceiverAccount (/home/runner/work/FRW-Extension/FRW-Extension/e2e/utils/helper.ts:371:3)
    at /home/runner/work/FRW-Extension/FRW-Extension/e2e/transaction/transaction.setup.ts:8:3
```

# Page snapshot

```yaml
- listitem:
  - button "Create a new account":
    - img
    - text: Create a new account
```

# Test source

```ts
  163 |
  164 |   // got keys from clipboard
  165 |   const clipboardText = await page.evaluate(getClipboardText);
  166 |
  167 |   const keyArr = clipboardText.split(' ');
  168 |
  169 |   // next step
  170 |   await page.getByRole('button', { name: 'Okay, I have saved it properly' }).click();
  171 |
  172 |   // get puzzles
  173 |   const firstIdx = await page.locator('div').getByText('#').first().textContent();
  174 |   const secondIdx = await page.locator('div').getByText('#').nth(1).textContent();
  175 |   const thirdIdx = await page.locator('div').getByText('#').nth(2).textContent();
  176 |
  177 |   const firstMnemonic = keyArr[getNumber(firstIdx!)! - 1];
  178 |   const secondMnemonic = keyArr[getNumber(secondIdx!)! - 1];
  179 |   const thirdMnemonic = keyArr[getNumber(thirdIdx!)! - 1];
  180 |
  181 |   // console.log(firstMnemonic, secondMnemonic, thirdMnemonic);
  182 |   // click the right mnemonic word
  183 |
  184 |   // resolve mnemonics puzzles
  185 |   await page.getByLabel('row0').getByRole('button', { name: firstMnemonic }).click();
  186 |   await page.getByLabel('row1').getByRole('button', { name: secondMnemonic }).click();
  187 |   await page.getByLabel('row2').getByRole('button', { name: thirdMnemonic }).click();
  188 |
  189 |   await page
  190 |     .locator('div')
  191 |     .filter({ hasText: /^Next$/ })
  192 |     .click();
  193 |
  194 |   // fill
  195 |   await fillInPassword({ page, password });
  196 |
  197 |   await page.getByLabel("I agree to Flow Wallet's").click();
  198 |
  199 |   const registerBtn = await page.getByRole('button', { name: 'Register' });
  200 |   await registerBtn.click();
  201 |   await expect(page.getByRole('button', { name: 'Connect and Back up' })).toBeVisible({
  202 |     timeout: 120_000,
  203 |   });
  204 |
  205 |   // await unlockBtn.isEnabled();
  206 |   await page.goto(`chrome-extension://${extensionId}/index.html#/dashboard`);
  207 |
  208 |   // get address
  209 |
  210 |   const flowAddr = await getCurrentAddress(page);
  211 |
  212 |   // save keys and pwd to keys file
  213 |   return {
  214 |     privateKey: clipboardText,
  215 |     password: password,
  216 |     addr: flowAddr,
  217 |   };
  218 | };
  219 |
  220 | export const registerTestUser = async ({ page, extensionId }) => {
  221 |   const username = `testuser${String.fromCharCode(
  222 |     ...Array(4)
  223 |       .fill(0)
  224 |       .map(() => Math.floor(Math.random() * 26) + 97)
  225 |   )}`;
  226 |   const password = process.env.TEST_PASSWORD;
  227 |   if (!password) {
  228 |     throw new Error('TEST_PASSWORD is not set');
  229 |   }
  230 |
  231 |   const {
  232 |     privateKey,
  233 |     password: pwd,
  234 |     addr,
  235 |   } = await registerAccount({ page, extensionId, username, password });
  236 |
  237 |   await saveAuth({
  238 |     privateKey,
  239 |     password: pwd,
  240 |     addr,
  241 |     nickname: username,
  242 |   });
  243 | };
  244 |
  245 | export const importAccountBySeedPhrase = async ({
  246 |   page,
  247 |   extensionId,
  248 |   seedPhrase,
  249 |   username,
  250 |   accountAddr = '',
  251 | }) => {
  252 |   const password = process.env.TEST_PASSWORD;
  253 |   if (!password) {
  254 |     throw new Error('TEST_PASSWORD is not set');
  255 |   }
  256 |   if (page.url().includes('dashboard')) {
  257 |     // Wait for the dashboard page to be fully loaded
  258 |     await page.waitForURL(/.*\/dashboard.*/);
  259 |
  260 |     // We're already logged in so we need to click import profile
  261 |     await page.getByTestId('account-menu-button').click();
  262 |     await page.getByTestId('add-account-button').click();
> 263 |     await page.getByTestId('import-existing-account-button').click();
      |                                                              ^ Error: locator.click: Target page, context or browser has been closed
  264 |     // Close all pages except the current page (the extension opens them in the background)
  265 |     await closeOpenedPages(page);
  266 |   }
  267 |
  268 |   // Go to the import page
  269 |   await page.goto(`chrome-extension://${extensionId}/index.html#/welcome/accountimport`);
  270 |
  271 |   // Close all pages except the current page (the extension opens them in the background)
  272 |   await closeOpenedPages(page);
  273 |
  274 |   await page.getByRole('tab', { name: 'Recovery Phrase' }).click();
  275 |   await page.getByPlaceholder('Import 12 or 24 words split').click();
  276 |
  277 |   await page.getByPlaceholder('Import 12 or 24 words split').fill(seedPhrase);
  278 |
  279 |   await page.getByRole('button', { name: 'Import' }).click();
  280 |   // We need to wait for the next step to be visible
  281 |
  282 |   await expect(page.getByRole('button', { name: 'Import' })).not.toBeVisible();
  283 |
  284 |   const step = await page.getByText('STEP').textContent();
  285 |
  286 |   if (step.includes('4')) {
  287 |     // We've already imported the account before
  288 |     await fillInPassword({ page, password });
  289 |
  290 |     await page.getByRole('button', { name: 'Login' }).click();
  291 |     // await page.getByRole('button', { name: 'Login' }).click();
  292 |   } else if (step.includes('2')) {
  293 |     // We haven't imported the account before
  294 |     await page.getByPlaceholder('Username').fill(username);
  295 |     await page.getByRole('button', { name: 'Next' }).click();
  296 |
  297 |     await fillInPassword({ page, password });
  298 |
  299 |     await page.getByRole('button', { name: 'Login' }).click();
  300 |   }
  301 |
  302 |   // Wait for the Google Drive backup text to be visible
  303 |   await expect(page.getByRole('button', { name: 'Connect and Back up' })).toBeVisible({
  304 |     timeout: 10_000,
  305 |   });
  306 |
  307 |   await page.goto(`chrome-extension://${extensionId}/index.html#/dashboard`);
  308 |   await page.waitForURL(/.*\/dashboard.*/);
  309 |
  310 |   // Wait for the account address to be visible
  311 |   let flowAddr = await getCurrentAddress(page);
  312 |
  313 |   if (accountAddr && flowAddr !== accountAddr) {
  314 |     await switchToMainAccount({ page, address: accountAddr });
  315 |     flowAddr = await getCurrentAddress(page);
  316 |   }
  317 |   if (accountAddr && flowAddr !== accountAddr) {
  318 |     throw new Error('Account address does not match');
  319 |   }
  320 |
  321 |   return flowAddr;
  322 | };
  323 |
  324 | export const importSenderAccount = async ({ page, extensionId }) => {
  325 |   await importAccountBySeedPhrase({
  326 |     page,
  327 |     extensionId,
  328 |     seedPhrase: process.env.TEST_SEED_PHRASE_SENDER,
  329 |     username: 'sender',
  330 |     accountAddr: process.env.TEST_SENDER_ADDR,
  331 |   });
  332 | };
  333 |
  334 | export const loginToSenderAccount = async ({ page, extensionId }) => {
  335 |   if (!process.env.TEST_SENDER_ADDR) {
  336 |     throw new Error('TEST_SENDER_ADDR is not set');
  337 |   }
  338 |
  339 |   if (!process.env.TEST_PASSWORD) {
  340 |     throw new Error('TEST_PASSWORD is not set');
  341 |   }
  342 |
  343 |   await loginToExtensionAccount({
  344 |     page,
  345 |     extensionId,
  346 |     addr: process.env.TEST_SENDER_ADDR!,
  347 |     password: process.env.TEST_PASSWORD!,
  348 |     nickname: process.env.TEST_SENDER_NICKNAME!,
  349 |   });
  350 | };
  351 |
  352 | export const loginToReceiverAccount = async ({ page, extensionId }) => {
  353 |   if (!process.env.TEST_RECEIVER_ADDR) {
  354 |     throw new Error('TEST_RECEIVER_ADDR is not set');
  355 |   }
  356 |
  357 |   if (!process.env.TEST_PASSWORD) {
  358 |     throw new Error('TEST_PASSWORD is not set');
  359 |   }
  360 |
  361 |   await loginToExtensionAccount({
  362 |     page,
  363 |     extensionId,
```