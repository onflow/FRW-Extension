<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto Library Benchmark Results (Standalone)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      h1 {
        color: #333;
        text-align: center;
      }
      .chart-container {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .summary {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .library-card {
        background: #f8f9fa;
        padding: 15px;
        margin: 10px 0;
        border-radius: 6px;
        border-left: 4px solid #007bff;
      }
      .fastest {
        border-left-color: #28a745;
      }
      .slowest {
        border-left-color: #dc3545;
      }
      canvas {
        max-height: 400px;
      }
      .metadata {
        text-align: center;
        color: #666;
        margin: 10px 0;
        font-size: 14px;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }
      .file-input-container {
        text-align: center;
        margin: 20px 0;
      }
      .file-input {
        padding: 10px;
        border: 2px dashed #007bff;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        display: inline-block;
      }
      .file-input:hover {
        background: #f0f8ff;
      }
      .instructions {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Crypto Library Benchmark Results (Standalone)</h1>

      <div class="instructions">
        <p>
          <strong>Instructions:</strong> Click below to load the benchmark-latest.json file from
          your benchmark run.
        </p>
        <p>This standalone version works with file:// protocol and doesn't require a web server.</p>
      </div>

      <div class="file-input-container">
        <label class="file-input">
          <input type="file" id="fileInput" accept=".json" style="display: none" />
          Load benchmark-latest.json
        </label>
      </div>

      <div class="metadata" id="metadata">
        <p>No data loaded yet</p>
      </div>

      <div id="content">
        <div class="loading">Please load a benchmark results file...</div>
      </div>
    </div>

    <script>
      let charts = [];

      document.getElementById('fileInput').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const data = JSON.parse(e.target.result);
              displayResults(data);

              // Update metadata
              const date = new Date(data.timestamp);
              document.getElementById('metadata').innerHTML = `
                            <p>Last run: ${date.toLocaleString()}</p>
                            <p>Platform: ${data.systemInfo.platform} | Node: ${data.systemInfo.nodeVersion} | Architecture: ${data.systemInfo.arch}</p>
                        `;
            } catch (error) {
              document.getElementById('content').innerHTML = `
                            <div class="error">
                                <h3>Error Loading Data</h3>
                                <p>${error.message}</p>
                                <p>Please make sure you selected a valid benchmark JSON file.</p>
                            </div>
                        `;
            }
          };
          reader.readAsText(file);
        }
      });

      function displayResults(data) {
        const results = data.results;
        const contentDiv = document.getElementById('content');

        // Clear existing charts
        charts.forEach((chart) => chart.destroy());
        charts = [];

        // Group results by operation
        const operationGroups = {};
        results.forEach((result) => {
          if (!operationGroups[result.operation]) {
            operationGroups[result.operation] = [];
          }
          operationGroups[result.operation].push(result);
        });

        // Create summary
        let summaryHTML = '<div class="summary"><h2>Summary</h2>';

        // Find fastest and slowest for each operation
        Object.keys(operationGroups).forEach((operation) => {
          const group = operationGroups[operation];
          const sorted = [...group].sort((a, b) => a.timeMs - b.timeMs);
          const fastest = sorted[0];
          const slowest = sorted[sorted.length - 1];

          summaryHTML += `
                    <div class="library-card">
                        <h3>${operation}</h3>
                        <p><strong>Fastest:</strong> ${fastest.library} - ${fastest.timeMs.toFixed(3)}ms</p>
                        <p><strong>Slowest:</strong> ${slowest.library} - ${slowest.timeMs.toFixed(3)}ms</p>
                        <p><strong>Difference:</strong> ${(slowest.timeMs / fastest.timeMs).toFixed(1)}x slower</p>
                    </div>
                `;
        });

        summaryHTML += '</div>';

        // Create charts
        let chartsHTML = '';
        Object.keys(operationGroups).forEach((operation, index) => {
          chartsHTML += `
                    <div class="chart-container">
                        <h3>${operation} Performance Comparison</h3>
                        <canvas id="chart-${index}"></canvas>
                    </div>
                `;
        });

        contentDiv.innerHTML = summaryHTML + chartsHTML;

        // Render charts
        Object.keys(operationGroups).forEach((operation, index) => {
          const group = operationGroups[operation];
          const sorted = [...group].sort((a, b) => a.timeMs - b.timeMs);

          const ctx = document.getElementById(`chart-${index}`).getContext('2d');
          const chart = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: sorted.map((r) => r.library),
              datasets: [
                {
                  label: 'Time (ms)',
                  data: sorted.map((r) => r.timeMs),
                  backgroundColor: sorted.map((r, i) => {
                    if (i === 0) return 'rgba(40, 167, 69, 0.8)'; // Green for fastest
                    if (i === sorted.length - 1) return 'rgba(220, 53, 69, 0.8)'; // Red for slowest
                    return 'rgba(0, 123, 255, 0.8)'; // Blue for others
                  }),
                  borderColor: sorted.map((r, i) => {
                    if (i === 0) return 'rgb(40, 167, 69)';
                    if (i === sorted.length - 1) return 'rgb(220, 53, 69)';
                    return 'rgb(0, 123, 255)';
                  }),
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'Time (milliseconds)',
                  },
                },
              },
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      return `${context.parsed.y.toFixed(3)} ms`;
                    },
                  },
                },
              },
            },
          });

          charts.push(chart);
        });
      }

      // Also try to load from embedded data if available
      if (typeof BENCHMARK_DATA !== 'undefined') {
        displayResults(BENCHMARK_DATA);
        document.getElementById('metadata').innerHTML = `
                <p>Last run: ${new Date(BENCHMARK_DATA.timestamp).toLocaleString()}</p>
                <p>Platform: ${BENCHMARK_DATA.systemInfo.platform} | Node: ${BENCHMARK_DATA.systemInfo.nodeVersion} | Architecture: ${BENCHMARK_DATA.systemInfo.arch}</p>
            `;
        document.querySelector('.instructions').style.display = 'none';
        document.querySelector('.file-input-container').style.display = 'none';
      }
    </script>
  </body>
</html>
